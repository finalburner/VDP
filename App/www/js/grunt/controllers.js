controllers.controller("AppCtrl",["$rootScope","$scope","$ionicModal","$stateParams","$timeout","socket","$state","P","ConnectivityMonitor","Notif","AuthService",function(e,o,n,t,i,l,c,r,a,s,d){a.startWatching(),l.on(r.SOCKET.CO,function(){l.emit(r.SOCKET.CC),s.Show("Connecté")}),o.list_N1=r.MODAL_N1,o.Cnx={username:"",password:""},o.currentUser=null,o.userRoles=r.USER_ROLES,o.isAuthorized=d.isAuthorized,o.setCurrentUser=function(e){o.currentUser=e},o.login=function(n){c.go("app.CT"),d.login(n).then(function(n){e.$broadcast(r.AUTH_EVENTS.loginSuccess),o.setCurrentUser(n),c.go("app.CT")},function(){e.$broadcast(r.AUTH_EVENTS.loginFailed)})},o.unlog=function(){e.$broadcast(r.AUTH_EVENTS.logoutSuccess),o.setCurrentUser(null),c.go("login")},n.fromTemplateUrl("templates/N0/login.html",function(e){o.modalCnx=e},{scope:o,animation:"slide-in-up",focusFirstInput:!0}),n.fromTemplateUrl("templates/N1/modalN1.html",function(e){o.modalN1=e},{scope:o,animation:"slide-in-up",focusFirstInput:!0}),o.CT_N1=function(o,n){e.Selected_CT=n,c.go("app.CTsyn")},o.closeN1=function(e){sel=e,menu_N1=!menu_N1},o.JAL=function(){e.Selected_CT="null"},o.N1_open=function(n,t){o.modalN1.show(),o.modalN1.name=n,o.modalN1.AL_Color=t,o.modalN1.animation="slide-left-right",e.Selected_CT=n},o.N1_close=function(e){o.modalN1.hide()}}]).controller("ConCtrl",["$scope","socket","$ionicLoading","$rootScope","$state","P",function(e,o,n,t,i,l){e.Selected_NomGrp=t.Selected_NomGrp,e.Selected_Grp=t.Selected_Grp,e.Validate_Item="",e.list_Cons=[],e.Selected_NomGrp&&e.Selected_Grp||i.go("app.CTsyn"),o.emit(l.SOCKET.CQ,{Mode:"Read",Selected_Grp:t.Selected_Grp,Selected_CT:t.Selected_CT}),o.on(l.SOCKET.CA,function(o){console.log(o),o.Value.toString().length>=6&&(o.Value=Math.round(o.Value).toFixed(2)),ConsIndex=e.list_Cons.findIndex(function(e){e.Mnemo,o.Mnemo}),-1==ConsIndex?e.list_Cons.push(o):e.list_Cons[ConsIndex]=o}),e.Write=function(e){e.Mode="Write",o.emit(l.SOCKET.CQ,e)},e.Analog_Change=function(e){e.Value!=e.Local_Value&&(e.Mode="Write",o.emit(l.SOCKET.CQ,e))}}]).controller("CTfic",["$scope","socket",function(e,o){e.Live_Update=[],o.on("update",function(o){e.Live_Update.push({id:o.id,value:o.value})})}]).controller("CTctrl",["$rootScope","$scope","socket","$ionicLoading","P","$cordovaGeolocation","$ionicSideMenuDelegate",function(e,o,n,t,i,l,c){e.$on("$stateChangeStart",function(e,o,n,t,i){"/carto"==o.url&&c.canDragContent(!1),"/carto"==t.url&&c.canDragContent(!0)});var r=[48.861253,2.32992];o.loc=r;var a={timeout:1e4,enableHighAccuracy:!1};l.getCurrentPosition(a).then(function(e){var n=[e.coords.latitude,e.coords.longitude];o.loc=n,o.marker=n,console.log(o.loc)},function(e){console.log(e)}),t.show({content:"Loading",animation:"fade-in",showBackdrop:!0,duration:700,maxWidth:200,showDelay:0}),o.list_CT=[],n.emit(i.SOCKET.CTQ),n.on(i.SOCKET.CTA,function(e){var n,t;n=i.ALARM.AL_0_Color,e.AL_1&&(n=i.ALARM.AL_1_Color),e.AL_2&&(n=i.ALARM.AL_2_Color),e.AL_3&&(n=i.ALARM.AL_3_Color),e.AL_10&&(n=i.ALARM.AL_10_Color),t={CT:e.localisation,AL_Color:n,LAT:e.LAT,LONG:e.LONG,ADR:e.ADR},ctIndex=o.list_CT.findIndex(function(o){o.localisation,e.localisation}),-1!=ctIndex?o.list_CT[ctIndex]=t:o.list_CT.push(t)}),o.CT_pow="100kW Gaz SED14",o.CT_alm="Message d'information caractérisant l'alarme.Ca peut être long",o.googleMapsUrl="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3QWWdY2M8JtbDSSrVriG9lIwD5anCRHo"}]).controller("ALctrl",["$rootScope","$scope","socket","$ionicLoading","P","$state","$stateParams",function(e,o,n,t,i,l,c){o.list_AL=[],o.Synthese_PresentCount=0,o.Filter_Alm,o.ACK=function(e){e.Ack?console.log("Alarme déja acquitée"):(e.Mode="Write",e.Type="ACK",n.emit(i.SOCKET.ALQ,e))},o.expand_AL=function(e){o.isItemExpanded(e)?o.shownItem=null:o.shownItem=e.Mnemo},o.isItemExpanded=function(e){return o.shownItem===e.Mnemo},n.on(i.SOCKET.OU,function(e){"Synthese.PresentCount"==e.id&&(o.Synthese_PresentCount=e.value),console.log(o.Synthese_PresentCount)}),o.$watch(["Synthese_PresentCount"],function(t,l){n.emit(i.SOCKET.ALQ,{Mode:"Read",Selected_CT:e.Selected_CT}),console.log("OPC Present NBR :"+o.Synthese_PresentCount)}),n.on(i.SOCKET.ALA,function(e){e.AL_Color=i.ALARM.AL_0_Color,"1"==e.Criticite&&(e.AL_Color=i.ALARM.AL_1_Color),"2"==e.Criticite&&(e.AL_Color=i.ALARM.AL_2_Color),"3"==e.Criticite&&(e.AL_Color=i.ALARM.AL_3_Color),"10"==e.Criticite&&(e.AL_Color=i.ALARM.AL_10_Color),e.Actif?e.Actif_Label="Présente":e.Actif_Label="Disparue",e.Ack?e.Ack_Label="Acquittée":e.Ack_Label="Non Acquitée",almIndex=o.list_AL.findIndex(function(o){o.Mnemo,e.Mnemo}),-1!=almIndex?o.list_AL[almIndex]=e:o.list_AL.push(e)})}]).controller("CTActrl",["$rootScope","$scope","socket","$state","P",function(e,o,n,t,i){o.Selected_CT=e.Selected_CT,o.Selected_CT||t.go("app.CT"),o.Consigne_Grp=function(o,n){e.Selected_NomGrp=o,e.Selected_Grp=n,t.go("app.CTcon")},o.List_CTA=[],o.expand_AL=function(e){o.isItemExpanded(e)?o.shownItem=null:o.shownItem=e},o.isItemExpanded=function(e){return o.shownItem===e},n.emit(i.SOCKET.CTAQ,{Selected_CT:o.Selected_CT}),n.on(i.SOCKET.CTAA,function(e){console.log(e),ctaIndex=o.List_CTA.findIndex(function(o){o.DesignGroupeFonctionnel,e.DesignGroupeFonctionnel}),console.log(ctaIndex),-1!=ctaIndex?o.List_CTA[ctaIndex]=e:o.List_CTA.push(e)})}]).controller("StaCtrl",["$scope","$rootScope","$state","socket","P",function(e,o,n,t,i){e.Selected_CT=o.Selected_CT,e.list_Sta=[],t.emit(i.SOCKET.SQ,{Mode:"Read",Selected_CT:e.Selected_CT}),t.on(i.SOCKET.SA,function(o){console.log(o),StaIndex=e.list_Sta.findIndex(function(e){e.Mnemo,o.Mnemo}),-1==StaIndex?e.list_Sta.push(o):e.list_Sta[StaIndex]=o}),e.Write=function(e){e.Mode="Write",t.emit(i.SOCKET.CQ,e)}}]).controller("QrCtrl",["$scope","$rootScope","$cordovaBarcodeScanner","$ionicPlatform",function(e,o,n,t){e.scan=function(){t.ready(function(){n.scan().then(function(o){e.scanResults="We got a barcode\nResult: "+o.text+"\nFormat: "+o.format+"\nCancelled: "+o.cancelled},function(o){e.scanResults="Error: "+o})})},e.scanResults=""}]).controller("AdminCtrl",["$scope","socket","$ionicLoading","P",function(e,o,n,t){e.Validate_Item="",e.list_Cons=[],o.emit(t.SOCKET.CQ,{Mode:"Read"}),o.on(t.SOCKET.CA,function(o){o.Value.toString().length>=6&&(o.Value=Math.round(o.Value).toFixed(2)),ConsIndex=e.list_Cons.findIndex(function(e){e.Mnemo,o.Mnemo}),-1==ConsIndex?e.list_Cons.push(o):e.list_Cons[ConsIndex]=o}),e.Write=function(e){e.Mode="Write",o.emit(t.SOCKET.CQ,e)},e.Analog_Change=function(e){e.Value!=e.Local_Value&&(e.Mode="Write",o.emit(t.SOCKET.CQ,e))}}]).controller("MyCtrl",["$scope","$cordovaNetwork","$rootScope",function(e,o,n){document.addEventListener("deviceready",function(){e.network=o.getNetwork(),e.isOnline=o.isOnline(),e.$apply(),n.$on("$cordovaNetwork:online",function(n,t){e.isOnline=!0,e.network=o.getNetwork(),e.$apply()}),n.$on("$cordovaNetwork:offline",function(n,t){console.log("got offline"),e.isOnline=!1,e.network=o.getNetwork(),e.$apply()})},!1)}]);